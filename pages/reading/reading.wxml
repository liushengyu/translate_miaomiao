<view class="smart-reading-container">
  <!-- æœåŠ¡çŠ¶æ€æç¤º -->
  <view class="status-tip" wx:if="{{serviceStatus.isLoaded && !serviceStatus.speechAvailable}}">
    <text class="status-text">âš ï¸ å½“å‰ä½¿ç”¨æ¨¡æ‹Ÿè¯­éŸ³æœåŠ¡ï¼Œè¯·å‚è€ƒæ–‡æ¡£é…ç½®çœŸå®API</text>
  </view>

  <!-- æ–‡æœ¬è¾“å…¥åŒºåŸŸ -->
  <view class="input-section">
    <textarea
      class="text-input"
      placeholder="è¯·è¾“å…¥è‹±æ–‡æ–‡æœ¬..."
      value="{{inputText}}"
      bindinput="onTextInput"
      maxlength="1000">
    </textarea>
    <button class="process-btn" bindtap="processText">å¼€å§‹æ™ºèƒ½é˜…è¯»</button>
  </view>

  <!-- æ™ºèƒ½é˜…è¯»åŒºåŸŸ -->
  <view class="smart-reading-section" wx:if="{{processedWords.length > 0}}">
    <view class="section-header">
      <text class="section-title">æ™ºèƒ½ç‚¹è¯»åŒºåŸŸ</text>
      <view class="reading-controls">

        <button
          class="control-btn stop-btn"
          bindtap="stopReading"
          wx:if="{{isPlayingAll}}"
        >
          <text class="btn-icon">â¹ï¸</text>
          <text>åœæ­¢æ’­æ”¾</text>
        </button>
      </view>
    </view>

    <!-- æ™ºèƒ½æ–‡æœ¬å±•ç¤ºåŒºåŸŸ -->
    <view class="smart-text-area">
      <!-- æ’­æ”¾çŠ¶æ€æŒ‡ç¤º -->
      <view class="play-indicator" wx:if="{{isPlayingAll}}">
        <view class="indicator-content">
          <text class="loading-icon">ğŸ”Š</text>
          <text class="indicator-text">æ­£åœ¨å…¨æ–‡æ’­æ”¾ä¸­...</text>
          <view class="progress-wave">
            <view class="wave"></view>
            <view class="wave"></view>
            <view class="wave"></view>
          </view>
        </view>
      </view>

      <!-- æ™ºèƒ½æ–‡æœ¬å†…å®¹ -->
      <view class="smart-text-content" wx:if="{{!isPlayingAll}}">
        <text
          wx:for="{{processedWords}}"
          wx:key="index"
          class="smart-word {{item.type === 'word' ? 'word' : 'punctuation'}} {{item.isPlaying ? 'playing' : ''}} {{item.isSelected ? 'selected' : ''}}"
          data-index="{{index}}"
          data-word="{{item.text}}"
          bindtap="onWordTap"
          hover-class="word-hover"
          hover-start-time="50"
          hover-stay-time="100"
        >{{item.text}}</text>
      </view>

      <!-- å½“å‰æ’­æ”¾çŠ¶æ€ -->
      <view class="current-play-status" wx:if="{{currentPlayingWord && !isPlayingAll}}">
        <view class="status-content">
          <text class="status-icon">ğŸµ</text>
          <text class="status-text">æ­£åœ¨æ’­æ”¾: {{currentPlayingWord}}</text>
          <view class="play-animation">
            <view class="sound-wave"></view>
            <view class="sound-wave"></view>
            <view class="sound-wave"></view>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view wx:if="{{processedWords.length === 0}}" class="empty-state">
        <text class="empty-icon">ğŸ“„</text>
        <text class="empty-text">å¤„ç†åçš„æ–‡æœ¬å°†åœ¨è¿™é‡Œæ˜¾ç¤º</text>
        <text class="empty-hint">ç‚¹å‡»å•è¯æ’­æ”¾ï¼Œé•¿æŒ‰æ’­æ”¾è¯ç»„</text>
      </view>
    </view>
  </view>

  <!-- ç¿»è¯‘æ°”æ³¡ -->
  <view class="translation-bubble-overlay" wx:if="{{showTranslationBubble}}" bindtap="hideTranslationBubble">
    <view
      class="translation-bubble"
      style="left: {{bubbleContent.position.x}}px; top: {{bubbleContent.position.y}}px;"
      catchtap=""
    >
      <view class="bubble-arrow"></view>
      <view class="bubble-content">
        <view class="bubble-header">
          <text class="bubble-word">{{bubbleContent.word}}</text>
          <button class="bubble-close" bindtap="onBubbleClose">Ã—</button>
        </view>
        <view class="bubble-body">
          <text class="bubble-translation">{{bubbleContent.translation}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å­¦ä¹ ç»Ÿè®¡ -->
  <view class="stats-section card">
    <view class="stats-header">
      <text class="stats-title">ä»Šæ—¥å­¦ä¹ ç»Ÿè®¡</text>
      <text class="stats-desc">è®°å½•æ‚¨çš„å­¦ä¹ è¿›åº¦</text>
    </view>
    <view class="stats-grid">
      <view class="stat-card words">
        <text class="stat-icon">ğŸ“</text>
        <text class="stat-number">{{todayStats.wordsRead}}</text>
        <text class="stat-label">æœ—è¯»å•è¯</text>
      </view>
      <view class="stat-card sentences">
        <text class="stat-icon">ğŸ“–</text>
        <text class="stat-number">{{todayStats.sentencesRead}}</text>
        <text class="stat-label">æœ—è¯»å¥å­</text>
      </view>
      <view class="stat-card time">
        <text class="stat-icon">â°</text>
        <text class="stat-number">{{Math.round(todayStats.timeSpent)}}</text>
        <text class="stat-label">å­¦ä¹ æ—¶é•¿(åˆ†)</text>
      </view>
    </view>
  </view>

  <!-- æ”¶è—çš„å•è¯ -->
  <view class="favorites-section card" wx:if="{{favoriteWords.length > 0}}">
    <view class="favorites-header">
      <text class="favorites-title">æ”¶è—çš„å•è¯</text>
      <text class="favorites-count">å…±{{favoriteWords.length}}ä¸ª</text>
      <button class="clear-btn" bindtap="clearFavorites">æ¸…ç©º</button>
    </view>
    <view class="favorites-content">
      <view
        class="favorite-item"
        wx:for="{{favoriteWords}}"
        wx:key="index"
      >
        <button
          class="favorite-word"
          bindtap="speakFavorite"
          data-word="{{item}}"
        >
          <text class="word-icon">ğŸ”Š</text>
          <text class="word-text">{{item}}</text>
        </button>
        <button
          class="remove-btn"
          bindtap="removeFavorite"
          data-word="{{item}}"
          catchtap=""
        >
          <text>Ã—</text>
        </button>
      </view>
    </view>
  </view>
</view>

<!-- å•è¯è¯¦æƒ…æ¨¡æ€æ¡† -->
<view class="modal-overlay" wx:if="{{showWordModal}}" bindtap="closeWordModal">
  <view class="modal-content" catchtap="">
    <view class="modal-header">
      <text class="modal-title">å•è¯è¯¦æƒ…</text>
      <button class="modal-close" bindtap="closeWordModal">Ã—</button>
    </view>
    <view class="modal-body">
      <view class="word-detail">
        <text class="detail-word">{{selectedWordDetail.word}}</text>
        <text class="detail-phonetic">{{selectedWordDetail.phonetic}}</text>
        <text class="detail-meaning">{{selectedWordDetail.meaning}}</text>
        <view class="detail-actions">
          <button class="btn-primary" bindtap="speakDetailWord" disabled="{{isPlaying}}">ğŸ”Š æœ—è¯»</button>
          <button class="btn-secondary" bindtap="addToFavorites">â­ æ”¶è—</button>
        </view>
      </view>
    </view>
  </view>
</view>
