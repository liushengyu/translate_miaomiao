<view class="container">
  <!-- è¾“å…¥åŒºåŸŸ -->
  <view class="card">
    <view class="card-header">
      <view class="title-row">
        <text class="card-title">è¾“å…¥æ–‡æœ¬</text>
        <view class="language-selector-mini">
          <picker
            mode="selector"
            range="{{languageNames}}"
            value="{{fromLanguageIndex}}"
            bindchange="onFromLanguageChange"
            class="language-picker"
          >
            <view class="language-btn-mini">
              {{languageOptions[fromLanguage]}}
            </view>
          </picker>
          <text class="arrow-icon">â†’</text>
          <picker
            mode="selector"
            range="{{targetLanguageNames}}"
            value="{{toLanguageIndex}}"
            bindchange="onToLanguageChange"
            class="language-picker"
          >
            <view class="language-btn-mini">
              {{languageOptions[toLanguage]}}
            </view>
          </picker>
        </view>
      </view>
      <view class="header-tools">
        <text class="char-count">{{inputText.length}}/5000</text>
        <button class="tool-btn" bindtap="manualTranslate" size="mini" disabled="{{!inputText || isTranslating}}" wx:if="{{!isTranslating}}">
          âœ¨ ç¿»è¯‘
        </button>
        <button class="tool-btn" bindtap="speakOriginal" size="mini" disabled="{{!inputText || isPlaying}}" wx:if="{{!isPlaying}}">
          ğŸ”Š æœ—è¯»
        </button>
        <button class="tool-btn stop-btn" bindtap="stopPlaying" size="mini" wx:if="{{isPlaying}}">
          â¹ åœæ­¢
        </button>
      </view>
    </view>
    <textarea
      class="textarea {{isTranslating ? 'textarea-translating' : ''}}"
      placeholder="è¯·è¾“å…¥è¦ç¿»è¯‘çš„æ–‡æœ¬..."
      value="{{inputText}}"
      bindinput="onInputText"
      maxlength="5000"
      disabled="{{isTranslating}}"
      auto-height
    ></textarea>

    <!-- åŸæ–‡å•è¯æ˜¾ç¤ºåŒºåŸŸï¼ˆç”¨äºé€‰è¯ï¼‰ -->
    <view wx:if="{{processedOriginalText && processedOriginalText.length > 0}}" class="original-words-container">
      <text
        wx:for="{{processedOriginalText}}"
        wx:key="index"
        class="original-word {{item.isSelected ? 'selected' : ''}}"
        data-word="{{item.text}}"
        data-index="{{index}}"
        data-type="original"
        bindtap="onWordTap"
      >{{item.text}}</text>
    </view>
  </view>

  <!-- è¾“å‡ºåŒºåŸŸ -->
  <view class="card">
    <view class="card-header">
      <text class="card-title">ç¿»è¯‘ç»“æœ</text>
      <view class="header-tools">
        <view class="language-info" wx:if="{{detectedLanguage && !isTranslating}}">
          æ£€æµ‹åˆ°: {{getLanguageName(detectedLanguage)}}
        </view>
        <button class="tool-btn" bindtap="speakResult" size="mini" disabled="{{!translatedText || isPlaying}}" wx:if="{{translatedText && !isTranslating && !isPlaying}}">
          ğŸ”Š æœ—è¯»
        </button>
        <button class="tool-btn stop-btn" bindtap="stopPlaying" size="mini" wx:if="{{translatedText && !isTranslating && isPlaying}}">
          â¹ åœæ­¢
        </button>
        <button class="tool-btn" bindtap="copyResult" size="mini" disabled="{{!translatedText}}" wx:if="{{translatedText && !isTranslating}}">
          å¤åˆ¶
        </button>
      </view>
    </view>

    <view class="output-area {{isTranslating ? 'translating' : ''}}">
      <!-- ç¿»è¯‘ä¸­æç¤º -->
      <view class="translating-tip" wx:if="{{isTranslating}}">
        <text class="loading-icon">âŸ³</text>
        <text>æ­£åœ¨ç¿»è¯‘ä¸­...</text>
      </view>

      <!-- ç¿»è¯‘ç»“æœ -->
      <view wx:if="{{translatedText && !isTranslating}}" class="translated-content">
        <!-- ä½¿ç”¨åŒå‡»é€‰è¯çš„ç¿»è¯‘ç»“æœæ˜¾ç¤º -->
        <view class="result-text-container">
          <text
            wx:for="{{processedTranslatedText}}"
            wx:key="index"
            class="translated-word {{item.isSelected ? 'selected' : ''}}"
            data-word="{{item.text}}"
            data-index="{{index}}"
            data-type="translation"
            bindtap="onWordTap"
          >{{item.text}}</text>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view wx:if="{{!translatedText && !isTranslating}}" class="empty-state">
        <text>ç¿»è¯‘ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º</text>
      </view>
    </view>
  </view>
</view>

<!-- é€‰æ‹©èœå• -->
<view class="selection-menu-overlay" wx:if="{{showSelectionMenu}}" bindtap="exitSelectionMode">
  <view class="selection-menu" catchtap="">
    <view class="menu-header">
      <text class="selected-info">å·²é€‰æ‹© {{selectedWordCount}} ä¸ªè¯</text>
    </view>
    <view class="menu-actions">
      <button class="menu-btn play-btn" bindtap="speakSelectedText">
        <text class="btn-icon">ğŸ”Š</text>
        <text class="btn-text">æœ—è¯»</text>
      </button>
      <button class="menu-btn copy-btn" bindtap="copySelectedText">
        <text class="btn-icon">ğŸ“‹</text>
        <text class="btn-text">å¤åˆ¶</text>
      </button>
      <button class="menu-btn exit-btn" bindtap="exitSelectionMode">
        <text class="btn-icon">âŒ</text>
        <text class="btn-text">å–æ¶ˆ</text>
      </button>
    </view>
  </view>
</view>
