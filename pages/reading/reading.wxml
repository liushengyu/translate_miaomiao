<view class="smart-reading-container">
  <!-- 服务状态提示 -->
  <view class="status-tip" wx:if="{{serviceStatus.isLoaded && !serviceStatus.speechAvailable}}">
    <text class="status-text">⚠️ 当前使用模拟语音服务，请参考文档配置真实API</text>
  </view>

  <!-- 文本输入区域 -->
  <view class="input-section">
    <textarea
      class="text-input"
      placeholder="请输入英文文本..."
      value="{{inputText}}"
      bindinput="onTextInput"
      maxlength="1000">
    </textarea>
    <button class="process-btn" bindtap="processText">开始智能阅读</button>
  </view>

  <!-- 智能阅读区域 -->
  <view class="smart-reading-section" wx:if="{{processedWords.length > 0}}">
    <view class="section-header">
      <text class="section-title">智能点读区域</text>
      <view class="reading-controls">

        <button
          class="control-btn stop-btn"
          bindtap="stopReading"
          wx:if="{{isPlayingAll}}"
        >
          <text class="btn-icon">⏹️</text>
          <text>停止播放</text>
        </button>
      </view>
    </view>

    <!-- 智能文本展示区域 -->
    <view class="smart-text-area">
      <!-- 播放状态指示 -->
      <view class="play-indicator" wx:if="{{isPlayingAll}}">
        <view class="indicator-content">
          <text class="loading-icon">🔊</text>
          <text class="indicator-text">正在全文播放中...</text>
          <view class="progress-wave">
            <view class="wave"></view>
            <view class="wave"></view>
            <view class="wave"></view>
          </view>
        </view>
      </view>

      <!-- 智能文本内容 -->
      <view class="smart-text-content" wx:if="{{!isPlayingAll}}">
        <text
          wx:for="{{processedWords}}"
          wx:key="index"
          class="smart-word {{item.type === 'word' ? 'word' : 'punctuation'}} {{item.isPlaying ? 'playing' : ''}} {{item.isSelected ? 'selected' : ''}}"
          data-index="{{index}}"
          data-word="{{item.text}}"
          bindtap="onWordTap"
          hover-class="word-hover"
          hover-start-time="50"
          hover-stay-time="100"
        >{{item.text}}</text>
      </view>

      <!-- 当前播放状态 -->
      <view class="current-play-status" wx:if="{{currentPlayingWord && !isPlayingAll}}">
        <view class="status-content">
          <text class="status-icon">🎵</text>
          <text class="status-text">正在播放: {{currentPlayingWord}}</text>
          <view class="play-animation">
            <view class="sound-wave"></view>
            <view class="sound-wave"></view>
            <view class="sound-wave"></view>
          </view>
        </view>
      </view>

      <!-- 空状态 -->
      <view wx:if="{{processedWords.length === 0}}" class="empty-state">
        <text class="empty-icon">📄</text>
        <text class="empty-text">处理后的文本将在这里显示</text>
        <text class="empty-hint">点击单词播放，长按播放词组</text>
      </view>
    </view>
  </view>

  <!-- 翻译气泡 -->
  <view class="translation-bubble-overlay" wx:if="{{showTranslationBubble}}" bindtap="hideTranslationBubble">
    <view
      class="translation-bubble"
      style="left: {{bubbleContent.position.x}}px; top: {{bubbleContent.position.y}}px;"
      catchtap=""
    >
      <view class="bubble-arrow"></view>
      <view class="bubble-content">
        <view class="bubble-header">
          <text class="bubble-word">{{bubbleContent.word}}</text>
          <button class="bubble-close" bindtap="onBubbleClose">×</button>
        </view>
        <view class="bubble-body">
          <text class="bubble-translation">{{bubbleContent.translation}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 学习统计 -->
  <view class="stats-section card">
    <view class="stats-header">
      <text class="stats-title">今日学习统计</text>
      <text class="stats-desc">记录您的学习进度</text>
    </view>
    <view class="stats-grid">
      <view class="stat-card words">
        <text class="stat-icon">📝</text>
        <text class="stat-number">{{todayStats.wordsRead}}</text>
        <text class="stat-label">朗读单词</text>
      </view>
      <view class="stat-card sentences">
        <text class="stat-icon">📖</text>
        <text class="stat-number">{{todayStats.sentencesRead}}</text>
        <text class="stat-label">朗读句子</text>
      </view>
      <view class="stat-card time">
        <text class="stat-icon">⏰</text>
        <text class="stat-number">{{Math.round(todayStats.timeSpent)}}</text>
        <text class="stat-label">学习时长(分)</text>
      </view>
    </view>
  </view>

  <!-- 收藏的单词 -->
  <view class="favorites-section card" wx:if="{{favoriteWords.length > 0}}">
    <view class="favorites-header">
      <text class="favorites-title">收藏的单词</text>
      <text class="favorites-count">共{{favoriteWords.length}}个</text>
      <button class="clear-btn" bindtap="clearFavorites">清空</button>
    </view>
    <view class="favorites-content">
      <view
        class="favorite-item"
        wx:for="{{favoriteWords}}"
        wx:key="index"
      >
        <button
          class="favorite-word"
          bindtap="speakFavorite"
          data-word="{{item}}"
        >
          <text class="word-icon">🔊</text>
          <text class="word-text">{{item}}</text>
        </button>
        <button
          class="remove-btn"
          bindtap="removeFavorite"
          data-word="{{item}}"
          catchtap=""
        >
          <text>×</text>
        </button>
      </view>
    </view>
  </view>
</view>

<!-- 单词详情模态框 -->
<view class="modal-overlay" wx:if="{{showWordModal}}" bindtap="closeWordModal">
  <view class="modal-content" catchtap="">
    <view class="modal-header">
      <text class="modal-title">单词详情</text>
      <button class="modal-close" bindtap="closeWordModal">×</button>
    </view>
    <view class="modal-body">
      <view class="word-detail">
        <text class="detail-word">{{selectedWordDetail.word}}</text>
        <text class="detail-phonetic">{{selectedWordDetail.phonetic}}</text>
        <text class="detail-meaning">{{selectedWordDetail.meaning}}</text>
        <view class="detail-actions">
          <button class="btn-primary" bindtap="speakDetailWord" disabled="{{isPlaying}}">🔊 朗读</button>
          <button class="btn-secondary" bindtap="addToFavorites">⭐ 收藏</button>
        </view>
      </view>
    </view>
  </view>
</view>
