<view class="container">
  <!-- æœåŠ¡çŠ¶æ€æç¤º -->
  <view class="status-tip" wx:if="{{serviceStatus.isLoaded && !serviceStatus.speechAvailable}}">
    <text class="status-text">âš ï¸ å½“å‰ä½¿ç”¨æ¨¡æ‹Ÿè¯­éŸ³æœåŠ¡ï¼Œè¯·å‚è€ƒæ–‡æ¡£é…ç½®çœŸå®API</text>
  </view>

  <!-- æ–‡æœ¬è¾“å…¥åŒºåŸŸ -->
  <view class="text-input-section card">
    <view class="input-header">
      <text class="input-title">è¾“å…¥è‹±æ–‡æ–‡æœ¬è¿›è¡Œç‚¹è¯»</text>
    </view>
    <textarea
      class="reading-textarea"
      placeholder="è¯·è¾“å…¥è‹±æ–‡æ–‡æœ¬ï¼Œç‚¹å‡»å•è¯æˆ–å¥å­è¿›è¡Œæœ—è¯»..."
      value="{{inputText}}"
      bindinput="onTextChange"
      maxlength="2000"
      auto-height
    ></textarea>
    <view class="input-footer">
      <text class="char-count">{{inputText.length}}/2000</text>
      <view class="button-group">
        <button
          class="process-btn btn-primary"
          bindtap="processText"
          disabled="{{!inputText || isPlaying}}"
        >
          å¤„ç†æ–‡æœ¬
        </button>


      </view>
    </view>
  </view>

  <!-- é˜…è¯»æ–‡æœ¬åŒºåŸŸ -->
  <view class="reading-section" wx:if="{{processedWords.length > 0}}">
    <view class="section-header">
      <text class="section-title">å¤„ç†ç»“æœ</text>

      <view class="reading-controls">
        <button class="control-btn stop-btn"
                bindtap="stopReading"
                wx:if="{{isPlaying || isPlayingAll}}">
          ğŸ›‘ åœæ­¢æœ—è¯»
        </button>
      </view>
    </view>

    <!-- æ–‡æœ¬å±•ç¤ºåŒºåŸŸ - ç±»ä¼¼ç¿»è¯‘é¡µé¢çš„ç»“æœåŒºåŸŸ -->
    <view class="output-area">
      <!-- å¦‚æœæ­£åœ¨æ’­æ”¾å…¨éƒ¨ï¼Œæ˜¾ç¤ºæ’­æ”¾çŠ¶æ€ -->
      <view class="translating-tip" wx:if="{{isPlayingAll}}">
        <text class="loading-icon">ğŸ”Š</text>
        <text>æ­£åœ¨æœ—è¯»ä¸­...</text>
      </view>

      <!-- å¤„ç†åçš„æ–‡æœ¬å†…å®¹ -->
      <view wx:if="{{processedWords.length > 0 && !isPlayingAll}}" class="reading-content">
        <!-- ä½¿ç”¨å¯é€‰æ‹©çš„å•è¯å…ƒç´ æ˜¾ç¤ºæ–‡æœ¬ -->
        <view class="result-text-container">
          <text
            wx:for="{{processedWords}}"
            wx:key="index"
            class="result-word {{item.isSelected ? 'selected' : ''}} {{item.isPlaying ? 'playing' : ''}}"
            data-index="{{index}}"
            data-word="{{item.text}}"
            bindtap="onWordTap"
          >{{item.text}}</text>
        </view>

        <!-- æ’­æ”¾çŠ¶æ€æŒ‡ç¤º -->
        <view class="play-status" wx:if="{{currentPlayingWord}}">
          <text>æ­£åœ¨æ’­æ”¾: {{currentPlayingWord}}</text>
          <view class="play-progress">
            <view class="progress-bar" style="width: {{playProgress}}%"></view>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view wx:if="{{processedWords.length === 0}}" class="empty-state">
        <text>å¤„ç†åçš„æ–‡æœ¬å°†åœ¨è¿™é‡Œæ˜¾ç¤º</text>
      </view>
    </view>

    <!-- é€‰æ‹©çŠ¶æ€æç¤º -->
    <view class="selection-indicator" wx:if="{{isSelecting}}">
      <text class="selection-hint">æ»‘åŠ¨é€‰æ‹©æ–‡æœ¬...</text>
    </view>
  </view>

  <!-- é€‰æ‹©æ“ä½œèœå• - ä½¿ç”¨ä¸æ²‰æµ¸å¼é˜…è¯»ç›¸åŒçš„æ ·å¼ -->
  <view class="selection-menu-overlay" wx:if="{{showSelectionMenu && selectedText}}" bindtap="exitSelectionMode">
    <view class="selection-menu"
          style="left: {{menuPosition.x || 50}}px; top: {{menuPosition.y || 100}}px;"
          catchtap="">
      <view class="menu-content">
        <text class="selected-preview">{{selectedText.length > 30 ? selectedText.substring(0, 30) + '...' : selectedText}}</text>

        <view class="menu-actions">
          <button class="menu-btn play-btn" bindtap="speakSelectedText">
            <text class="icon">ğŸ”Š</text>
            <text>æ’­æ”¾</text>
          </button>

          <button class="menu-btn translate-btn" bindtap="translateSelectedText">
            <text class="icon">ğŸŒ</text>
            <text>ç¿»è¯‘</text>
          </button>

          <button class="menu-btn copy-btn" bindtap="copySelectedText">
            <text class="icon">ğŸ“‹</text>
            <text>å¤åˆ¶</text>
          </button>
        </view>

        <button class="menu-close" bindtap="exitSelectionMode">
          <text>âœ•</text>
        </button>
      </view>
    </view>
  </view>

  <!-- è¯­éŸ³è®¾ç½® -->
  <view class="voice-settings card">
    <view class="settings-header">
      <text class="settings-title">è¯­éŸ³è®¾ç½®</text>
    </view>
    <view class="settings-content">
      <view class="setting-item">
        <text class="setting-label">è¯­éŸ³é€Ÿåº¦</text>
        <slider
          class="setting-slider"
          min="0.5"
          max="2"
          step="0.1"
          value="{{voiceSettings.speed}}"
          bindchange="onSpeedChange"
          show-value
        />
      </view>
      <view class="setting-item">
        <text class="setting-label">éŸ³é‡å¤§å°</text>
        <slider
          class="setting-slider"
          min="0"
          max="1"
          step="0.1"
          value="{{voiceSettings.volume}}"
          bindchange="onVolumeChange"
          show-value
        />
      </view>
      <view class="setting-item">
        <text class="setting-label">è¯­éŸ³éŸ³è°ƒ</text>
        <slider
          class="setting-slider"
          min="0.5"
          max="2"
          step="0.1"
          value="{{voiceSettings.pitch}}"
          bindchange="onPitchChange"
          show-value
        />
      </view>
    </view>
  </view>

  <!-- ç¤ºä¾‹æ–‡æœ¬ -->
  <view class="examples-section card">
    <view class="examples-header">
      <text class="examples-title">ç¤ºä¾‹æ–‡æœ¬</text>
    </view>
    <view class="examples-content">
      <button
        class="example-btn"
        wx:for="{{exampleTexts}}"
        wx:key="index"
        bindtap="loadExample"
        data-text="{{item}}"
      >
        {{item}}
      </button>
    </view>
  </view>

  <!-- å­¦ä¹ ç»Ÿè®¡ -->
  <view class="stats-section card">
    <view class="stats-header">
      <text class="stats-title">ä»Šæ—¥å­¦ä¹ ç»Ÿè®¡</text>
    </view>
    <view class="stats-grid">
      <view class="stat-card">
        <text class="stat-number">{{todayStats.wordsRead}}</text>
        <text class="stat-label">æœ—è¯»å•è¯</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{todayStats.sentencesRead}}</text>
        <text class="stat-label">æœ—è¯»å¥å­</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{todayStats.timeSpent}}</text>
        <text class="stat-label">å­¦ä¹ æ—¶é•¿(åˆ†)</text>
      </view>
    </view>
  </view>

  <!-- æ”¶è—çš„å•è¯ -->
  <view class="favorites-section card" wx:if="{{favoriteWords.length > 0}}">
    <view class="favorites-header">
      <text class="favorites-title">æ”¶è—çš„å•è¯</text>
      <button class="tool-btn" bindtap="clearFavorites" size="mini">æ¸…ç©º</button>
    </view>
    <view class="favorites-content">
      <view
        class="favorite-word"
        wx:for="{{favoriteWords}}"
        wx:key="index"
        bindtap="speakFavorite"
        data-word="{{item}}"
      >
        <text class="word-text">{{item}}</text>
        <button
          class="remove-btn"
          bindtap="removeFavorite"
          data-word="{{item}}"
          catchtap=""
        >Ã—</button>
      </view>
    </view>
  </view>
</view>

<!-- å•è¯è¯¦æƒ…æ¨¡æ€æ¡† -->
<view class="modal-overlay" wx:if="{{showWordModal}}" bindtap="closeWordModal">
  <view class="modal-content" catchtap="">
    <view class="modal-header">
      <text class="modal-title">å•è¯è¯¦æƒ…</text>
      <button class="modal-close" bindtap="closeWordModal">Ã—</button>
    </view>
    <view class="modal-body">
      <view class="word-detail">
        <text class="detail-word">{{selectedWordDetail.word}}</text>
        <text class="detail-phonetic">{{selectedWordDetail.phonetic}}</text>
        <text class="detail-meaning">{{selectedWordDetail.meaning}}</text>
        <view class="detail-actions">
          <button class="btn-primary" bindtap="speakDetailWord" disabled="{{isPlaying}}">ğŸ”Š æœ—è¯»</button>
          <button class="btn-secondary" bindtap="addToFavorites">â­ æ”¶è—</button>
        </view>
      </view>
    </view>
  </view>
</view>
